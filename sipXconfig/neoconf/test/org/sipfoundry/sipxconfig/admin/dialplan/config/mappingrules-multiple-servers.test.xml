<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<mappings
  xmlns="http://www.sipfoundry.org/sipX/schema/xml/urlmap-00-00">

  <hostMatch>
    <hostPattern>example.org</hostPattern>
    <hostPattern>${MY_FULL_HOSTNAME}</hostPattern>
    <hostPattern>${MY_HOSTNAME}</hostPattern>
    <hostPattern>${MY_IP_ADDR}</hostPattern>

    <userMatch>
      <!--Music on Hold-->
      <description>Forward music-on-hold calls to Park Server</description>
      <userPattern>~~mh~</userPattern>
      <permissionMatch>
        <transform>
          <url>&lt;sip:moh@${ORBIT_SERVER_SIP_SRV_OR_HOSTPORT}&gt;</url>
        </transform>
      </permissionMatch>
    </userMatch>

    <userMatch>
      <!--RLS-->
      <description>Forward resource list subscriptions to RLS</description>
      <userPattern>~~rl~.</userPattern>
      <permissionMatch>
        <transform>
          <headerparams>Route=sip:${RLS_SIP_SRV_OR_HOSTPORT}</headerparams>
        </transform>
      </permissionMatch>
    </userMatch>

    <userMatch>
      <!--Operator-->
      <userPattern>100</userPattern>
      <userPattern>operator</userPattern>
      <userPattern>0</userPattern>
      <permissionMatch>
        <transform>
          <url>
            &lt;sip:{digits}@localhost;transport=tcp;voicexml=https%3A%2F%2Flocalhost%3A443%2Fcgi-bin%2Fvoicemail%2Fmediaserver.cgi%3Faction%3Dautoattendant%26name%3Doperator&gt;
          </url>
        </transform>
      </permissionMatch>
    </userMatch>

    <userMatch>
      <userPattern>101</userPattern>
      <permissionMatch>
        <transform>
          <url>
            &lt;sip:{digits}@localhost;transport=tcp;voicexml=https%3A%2F%2Flocalhost%3A443%2Fcgi-bin%2Fvoicemail%2Fmediaserver.cgi%3Faction%3Dretrieve&gt;
          </url>
        </transform>
      </permissionMatch>
    </userMatch>
    <userMatch>
      <userPattern>102</userPattern>
      <permissionMatch>
        <transform>
          <url>&lt;sip:102@exchange.example.com;transport=tcp&gt;</url>
        </transform>
      </permissionMatch>
    </userMatch>


    <userMatch>
      <userPattern>2xxx</userPattern>
      <permissionMatch>
        <transform>
          <url>
            &lt;sip:{vdigits}@localhost;transport=tcp;voicexml=https%3A%2F%2Flocalhost%3A443%2Fcgi-bin%2Fvoicemail%2Fmediaserver.cgi%3Faction%3Ddeposit%26mailbox%3D{vdigits-escaped}&gt;
          </url>
        </transform>
      </permissionMatch>
    </userMatch>
    <userMatch>
      <userPattern>2xxx</userPattern>
      <permissionMatch>
        <transform>
          <url>
            &lt;sip:102@exchange.example.com;transport=tcp?Diversion=%3Csip:{vdigits}%40{host}%3E%3Breason%3Dno-answer%3Bscreen%3Dno%3Bprivacy%3Doff&gt;
          </url>
        </transform>
      </permissionMatch>
    </userMatch>

    <userMatch>
      <userPattern>~~vm~.</userPattern>
      <permissionMatch>
        <permission>SipXVoicemailServer</permission>
        <transform>
          <url>
            &lt;sip:{vdigits}@localhost;transport=tcp;voicexml=https%3A%2F%2Flocalhost%3A443%2Fcgi-bin%2Fvoicemail%2Fmediaserver.cgi%3Faction%3Ddeposit%26mailbox%3D{vdigits-escaped}&gt;;q=0.1
          </url>
        </transform>
      </permissionMatch>
    </userMatch>
    <userMatch>
      <userPattern>~~vm~.</userPattern>
      <permissionMatch>
        <permission>ExchangeUMVoicemailServer</permission>
        <transform>
          <url>
            &lt;sip:102@exchange.example.com;transport=tcp?Diversion=%3Csip:{vdigits}%40{host}%3E%3Breason%3Dno-answer%3Bscreen%3Dno%3Bprivacy%3Doff&gt;;q=0.1
          </url>
        </transform>
      </permissionMatch>
    </userMatch>

    <userMatch>
      <userPattern>.</userPattern>
      <description>Voicemail redirect dialing rule</description>
      <permissionMatch>
        <permission>Voicemail</permission>
        <transform>
          <user>~~vm~{user}</user>
          <fieldparams>q=0.1</fieldparams>
        </transform>
      </permissionMatch>
    </userMatch>

  </hostMatch>
</mappings>
